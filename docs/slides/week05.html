<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.32">

  <meta name="author" content="Kelly Street">
  <title>PM 566 – Week 5: Data Wrangling</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-f563837468303362081e247dddd440d0.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Week 5: Data Wrangling</h1>
  <p class="subtitle">PM 566: Introduction to Health Data Science</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Kelly Street 
</div>
</div>
</div>

</section>
<section class="slide level2">

<!--Yeah... I have really long code chunks, so I just changed the default size :)-->
<style type="text/css">
code.*, .remark-code, pre {
  font-size:14px;
}
p,h1,h2,h3,h4 {
  font-family: system-ui
}
</style>
</section>
<section id="todays-goals" class="slide level2 smaller">
<h2>Today’s goals</h2>
<p>We will learn about how to manipulate data, and in particular,</p>
<ul>
<li>Selecting variables.</li>
<li>Filtering data.</li>
<li>Creating variables.</li>
<li>Summarize data.</li>
</ul>
<p>Throughout the session we will see examples using:</p>
<ul>
<li><a href="https://cran.r-project.org/package=data.table"><strong>data.table</strong></a> in R,</li>
<li><a href="https://cran.r-project.org/package=dplyr"><strong>dtplyr</strong></a> in R, and</li>
<li><a href="https://github.com/h2oai/datatable"><strong>pydatatable</strong></a></li>
</ul>
<p>All with the <a href="https://github.com/USCbiostats/data-science-data/">MET</a> dataset.</p>
</section>
<section id="disclaimer" class="slide level2">
<h2>Disclaimer</h2>
<p>There’s a lot of extraneous information in these slides! While the <code>data.table</code> package and Python both have a lot of useful functionality, we strongly recommend sticking to the base R and <code>tidyverse</code> tools presented here. Slides covering material outside this scope will be marked with an asterisk (<code>*</code>); you should be extremely cautious about using code from those slides!</p>
</section>
<section id="data-wrangling-in-r" class="slide level2 smaller">
<h2>Data wrangling in R</h2>
<p>Overall, you will find the following approaches:</p>
<ul>
<li><p><strong>base R</strong>: Use only base R functions.</p></li>
<li><p><strong>dplyr</strong>: Using “verbs”.</p></li>
<li><p><strong>data.table</strong>: High-performing (ideal for large data)</p></li>
<li><p><strong>dplyr + data.table = dtplyr</strong>: High-performing + dplyr verbs.</p></li>
</ul>
<p>Other methods involve, for example, using external tools such as <a href="http://spark.apache.org/">Spark</a>, <a href="https://cran.r-project.org/package=sparklyr">sparkly</a>.</p>
<p>We will be focusing on data.table because of <a href="https://h2oai.github.io/db-benchmark/">this</a></p>
<p>Take a look at this very neat cheat sheet by <a href="http://www.petrovski.dk/">Erik Petrovski</a> <a href="https://github.com/rstudio/cheatsheets/raw/master/datatable.pdf">here</a>.</p>
</section>
<section id="selecting-variables-load-the-packages" class="slide level2">
<h2>Selecting variables: Load the packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a></a><span class="fu">library</span>(dtplyr)</span>
<span id="cb1-3"><a></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>dtplyr</code> R package translates <code>dplyr</code> (<code>tidyverse</code>) syntax to <code>data.table</code>, so that we can still use <strong>the dplyr verbs</strong> while at the same time leveraging the performance of <code>data.table</code>.</p>
</section>
<section id="loading-the-data" class="slide level2 smaller">
<h2>Loading the data</h2>
<p>The data that we will be using is an already processed version of the MET dataset. We can download (and load) the data directly in our session using the following commands:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="co"># Where are we getting the data from</span></span>
<span id="cb2-2"><a></a>met_url <span class="ot">&lt;-</span> <span class="st">"https://github.com/USCbiostats/data-science-data/raw/master/02_met/met_all.gz"</span></span>
<span id="cb2-3"><a></a></span>
<span id="cb2-4"><a></a><span class="co"># Downloading the data to a tempfile (so it is destroyed afterwards)</span></span>
<span id="cb2-5"><a></a><span class="co"># you can replace this with, for example, your own data:</span></span>
<span id="cb2-6"><a></a>tmp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">pattern =</span> <span class="st">"met"</span>, <span class="at">fileext =</span> <span class="st">".gz"</span>)</span>
<span id="cb2-7"><a></a><span class="co"># tmp &lt;- "met.gz"</span></span>
<span id="cb2-8"><a></a></span>
<span id="cb2-9"><a></a><span class="co"># We should be downloading this, ONLY IF this was not downloaded already.</span></span>
<span id="cb2-10"><a></a><span class="co"># otherwise is just a waste of time.</span></span>
<span id="cb2-11"><a></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(tmp)) {</span>
<span id="cb2-12"><a></a>  <span class="fu">download.file</span>(</span>
<span id="cb2-13"><a></a>    <span class="at">url      =</span> met_url,</span>
<span id="cb2-14"><a></a>    <span class="at">destfile =</span> tmp,</span>
<span id="cb2-15"><a></a>    <span class="co"># method   = "libcurl", timeout = 1000 (you may need this option)</span></span>
<span id="cb2-16"><a></a>  )</span>
<span id="cb2-17"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can load the data using the <code>read.csv()</code> or <code>fread()</code> functions.</p>
</section>
<section id="read-the-data" class="slide level2 smaller">
<h2>Read the Data</h2>
<p>In R (base)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="co"># Reading the data</span></span>
<span id="cb3-2"><a></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(tmp)</span>
<span id="cb3-3"><a></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In R (<code>data.table</code>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="co"># Reading the data</span></span>
<span id="cb4-2"><a></a>dat <span class="ot">&lt;-</span> <span class="fu">fread</span>(tmp)</span>
<span id="cb4-3"><a></a><span class="fu">head</span>(dat)</span>
<span id="cb4-4"><a></a>dat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In Python</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a><span class="im">import</span> datatable <span class="im">as</span> dt</span>
<span id="cb5-2"><a></a>dat <span class="op">=</span> dt.fread(<span class="st">"met.gz"</span>)</span>
<span id="cb5-3"><a></a>dat.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we continue, let’s learn a bit more on <code>data.table</code> and <code>dtplyr</code></p>
</section>
<section id="data.table-and-dtplyr-data-tables-syntax" class="slide level2 smaller">
<h2>* <code>data.table</code> and <code>dtplyr</code>: Data Table’s Syntax</h2>
<ul>
<li>As you have seen in previous lectures, in <code>data.table</code> all happens within the square brackets. Here is common way to imagine DT:</li>
</ul>

<img data-src="img/datatable-syntax-paths.svg" width="700" class="r-stretch"><ul>
<li>Any time that you see <strong>:=</strong> in <strong>j</strong> that is “Assignment by reference.” Using <strong>=</strong> within <strong>j</strong> only works in some specific cases.</li>
</ul>
</section>
<section id="data.table-and-dtplyr-data-tables-syntax-1" class="slide level2 smaller">
<h2>* <code>data.table</code> and <code>dtplyr</code>: Data Table’s Syntax</h2>
<p>Operations applied in <strong>j</strong> are evaluated <em>within</em> the data, meaning that names work as symbols, e.g.,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="fu">data</span>(<span class="st">"USArrests"</span>)</span>
<span id="cb6-2"><a></a>USArrests_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(USArrests)</span>
<span id="cb6-3"><a></a><span class="co"># This returns an error</span></span>
<span id="cb6-4"><a></a>USArrests[, Murder]</span>
<span id="cb6-5"><a></a><span class="co"># This works fine</span></span>
<span id="cb6-6"><a></a>USArrests_dt[, Murder]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Furthermore, we can do things like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a>USArrests_dt[, <span class="fu">plot</span>(Murder, UrbanPop)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<img data-src="week05_files/figure-revealjs/plot-usarrests-1.png" width="672" class="r-stretch"></section>
<section id="data.table-and-dtplyr-lazy-table" class="slide level2">
<h2>* <code>data.table</code> and <code>dtplyr</code>: Lazy table</h2>
<ul>
<li><p>The <code>dtplyr</code> package provides a way to translate <code>dplyr</code> verbs to <code>data.table</code> syntax.</p></li>
<li><p>The key lies on the function <code>lazy_dt</code> from <code>dtplyr</code> (see <code>?dtplyr::lazy_dt</code>).</p></li>
<li><p>This function creates a wrapper that “points” to a <code>data.table</code> object</p></li>
</ul>
</section>
<section id="data.table-and-dtplyr-lazy-table-cont." class="slide level2">
<h2>* <code>data.table</code> and <code>dtplyr</code>: Lazy table (cont.)</h2>

<img data-src="img/pointer-paths.svg" width="800" class="r-stretch"><p>Question: What is the <code>immutable = FALSE</code> option used for?</p>
</section>
<section id="selecting-columns" class="slide level2">
<h2>* Selecting columns</h2>
<p>How can we select the columns <code>USAFID</code>, <code>lat</code>, and <code>lon</code>, using <code>data.table</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>dat[, <span class="fu">list</span>(USAFID, lat, lon)]</span>
<span id="cb9-2"><a></a><span class="co"># dat[, .(USAFID, lat, lon)]       # Alternative 1</span></span>
<span id="cb9-3"><a></a><span class="co"># dat[, c("USAFID", "lat", "lon")] # Alternative 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What happens if instead of <code>list()</code> you used <code>c()</code>?</p>
</section>
<section id="selecting-columns-cont.-1" class="slide level2">
<h2>Selecting columns (cont. 1)</h2>
<p>Using base R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">head</span>(</span>
<span id="cb10-2"><a></a>  dat[, <span class="fu">c</span>(<span class="st">'USAFID'</span>, <span class="st">'lat'</span>, <span class="st">'lon'</span>)]</span>
<span id="cb10-3"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  USAFID  lat      lon
1 690150 34.3 -116.166
2 690150 34.3 -116.166
3 690150 34.3 -116.166
4 690150 34.3 -116.166
5 690150 34.3 -116.166
6 690150 34.3 -116.166</code></pre>
</div>
</div>
</section>
<section id="selecting-columns-cont.-2" class="slide level2">
<h2>Selecting columns (cont. 2)</h2>
<p>Using the <strong>dplyr::select</strong> verb:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a>dat <span class="sc">|&gt;</span> <span class="fu">select</span>(USAFID, lat, lon) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  USAFID  lat      lon
1 690150 34.3 -116.166
2 690150 34.3 -116.166
3 690150 34.3 -116.166
4 690150 34.3 -116.166
5 690150 34.3 -116.166
6 690150 34.3 -116.166</code></pre>
</div>
</div>
</section>
<section id="selecting-columns-cont.-3" class="slide level2">
<h2>* Selecting columns (cont. 3)</h2>
<p>In the case of <code>pydatatable</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a>dat[:,[<span class="st">"USAFID"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What happens if instead of <code>["USAFID", "lat", "lon"]</code> you used <code>{"USAFID", "lat", "lon"}</code> (vector vs set).</p>
</section>
<section class="slide level2">

<p>For the rest of the session we will be using these variables: <code>USAFID</code>, <code>WBAN</code>, <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>min</code>, <code>lat</code>, <code>lon</code>, <code>elev</code>, <code>wind.sp</code>, <code>temp</code>, and <code>atm.press</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="co"># select only the relevant variables</span></span>
<span id="cb15-2"><a></a>dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a></a>  <span class="fu">select</span>(USAFID, WBAN, year, month, day, </span>
<span id="cb15-4"><a></a>         hour, min, lat, lon, elev, </span>
<span id="cb15-5"><a></a>         wind.sp, temp, atm.press)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-filtering-logical-conditions" class="slide level2 smaller">
<h2>Data filtering: Logical conditions</h2>
<ul>
<li><p>Based on logical operations, e.g.&nbsp;<code>condition 1 [and|or condition2 [and|or ...]]</code></p></li>
<li><p>Need to be aware of ordering and grouping of <code>and</code> and <code>or</code> operators.</p></li>
<li><p>Fundamental <strong>logical</strong> operators:</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<colgroup>
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 23%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">x</th>
<th style="text-align: center;">y</th>
<th style="text-align: center;">Negate<br>!x</th>
<th style="text-align: center;">And<br>x &amp; y</th>
<th style="text-align: center;">Or<br>x | y</th>
<th style="text-align: center;">Xor<br>xor(x, y)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">true</td>
<td style="text-align: center;">true</td>
<td style="text-align: center;">false</td>
<td style="text-align: center;">true</td>
<td style="text-align: center;">true</td>
<td style="text-align: center;">false</td>
</tr>
<tr class="even">
<td style="text-align: center;">false</td>
<td style="text-align: center;">true</td>
<td style="text-align: center;">true</td>
<td style="text-align: center;">false</td>
<td style="text-align: center;">true</td>
<td style="text-align: center;">true</td>
</tr>
<tr class="odd">
<td style="text-align: center;">true</td>
<td style="text-align: center;">false</td>
<td style="text-align: center;">false</td>
<td style="text-align: center;">false</td>
<td style="text-align: center;">true</td>
<td style="text-align: center;">true</td>
</tr>
<tr class="even">
<td style="text-align: center;">false</td>
<td style="text-align: center;">false</td>
<td style="text-align: center;">true</td>
<td style="text-align: center;">false</td>
<td style="text-align: center;">false</td>
<td style="text-align: center;">false</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Fundamental <strong>relational</strong> operators, in R: <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>==</code>, <code>!=</code>.</li>
</ul>
</section>
<section id="questions-1-how-many-ways-can-you-write-an-xor-operator" class="slide level2 smaller">
<h2>Questions 1: How many ways can you write an XOR operator?</h2>
<p>Write a function that takes two arguments <code>(x,y)</code> and applies the XOR operator element wise. Here you have a template:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a>myxor <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb16-2"><a></a>  res <span class="ot">&lt;-</span> <span class="fu">logical</span>(<span class="fu">length</span>(x))</span>
<span id="cb16-3"><a></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)) {</span>
<span id="cb16-4"><a></a>    res[i] <span class="ot">&lt;-</span> <span class="co"># do something with x[i] and y[i]</span></span>
<span id="cb16-5"><a></a>  }</span>
<span id="cb16-6"><a></a>  <span class="fu">return</span>(res)</span>
<span id="cb16-7"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or if vectorized (which would be better)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>myxor <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb17-2"><a></a>  <span class="co"># INSERT YOUR CODE HERE</span></span>
<span id="cb17-3"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Hint 1: Remember that negating <code>(x &amp; y)</code> equals <code>(!x | !y)</code>.</p>
<p>Hint 2: Logical operators are a distributive, meaning <code>a * (b + c) = (a * b) + (a + c)</code>, where <code>*</code> and <code>+</code> are <code>&amp;</code> or <code>|</code>.</p>
</section>
<section class="slide level2">

<p>In R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a>myxor1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y) {(x <span class="sc">&amp;</span> <span class="sc">!</span>y) <span class="sc">|</span> (<span class="sc">!</span>x <span class="sc">&amp;</span> y)}</span>
<span id="cb18-2"><a></a>myxor2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y) {<span class="sc">!</span>((<span class="sc">!</span>x <span class="sc">|</span> y) <span class="sc">&amp;</span> (x <span class="sc">|</span> <span class="sc">!</span>y))}</span>
<span id="cb18-3"><a></a>myxor3 <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y) {(x <span class="sc">|</span> y) <span class="sc">&amp;</span> (<span class="sc">!</span>x <span class="sc">|</span> <span class="sc">!</span>y)}</span>
<span id="cb18-4"><a></a>myxor4 <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y) {<span class="sc">!</span>((<span class="sc">!</span>x <span class="sc">&amp;</span> <span class="sc">!</span>y) <span class="sc">|</span> (x <span class="sc">&amp;</span> y))}</span>
<span id="cb18-5"><a></a><span class="fu">cbind</span>(</span>
<span id="cb18-6"><a></a>  <span class="fu">ifelse</span>(<span class="fu">xor</span>(test[,<span class="dv">1</span>], test[,<span class="dv">2</span>]), <span class="st">"true"</span>, <span class="st">"false"</span>),</span>
<span id="cb18-7"><a></a>  <span class="fu">ifelse</span>(<span class="fu">myxor1</span>(test[,<span class="dv">1</span>], test[,<span class="dv">2</span>]), <span class="st">"true"</span>, <span class="st">"false"</span>),</span>
<span id="cb18-8"><a></a>  <span class="fu">ifelse</span>(<span class="fu">myxor2</span>(test[,<span class="dv">1</span>], test[,<span class="dv">2</span>]), <span class="st">"true"</span>, <span class="st">"false"</span>),</span>
<span id="cb18-9"><a></a>  <span class="fu">ifelse</span>(<span class="fu">myxor3</span>(test[,<span class="dv">1</span>], test[,<span class="dv">2</span>]), <span class="st">"true"</span>, <span class="st">"false"</span>),</span>
<span id="cb18-10"><a></a>  <span class="fu">ifelse</span>(<span class="fu">myxor4</span>(test[,<span class="dv">1</span>], test[,<span class="dv">2</span>]), <span class="st">"true"</span>, <span class="st">"false"</span>)</span>
<span id="cb18-11"><a></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]    [,2]    [,3]    [,4]    [,5]   
[1,] "false" "false" "false" "false" "false"
[2,] "true"  "true"  "true"  "true"  "true" 
[3,] "true"  "true"  "true"  "true"  "true" 
[4,] "false" "false" "false" "false" "false"</code></pre>
</div>
</div>
</section>
<section id="or-in-python" class="slide level2">
<h2>* Or in python</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a></a><span class="co"># Loading the libraries</span></span>
<span id="cb20-2"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb20-3"><a></a><span class="im">import</span> pandas <span class="im">as</span> pa</span>
<span id="cb20-4"><a></a></span>
<span id="cb20-5"><a></a><span class="co"># Defining the data</span></span>
<span id="cb20-6"><a></a>x <span class="op">=</span> [<span class="va">True</span>, <span class="va">True</span>, <span class="va">False</span>, <span class="va">False</span>]</span>
<span id="cb20-7"><a></a>y <span class="op">=</span> [<span class="va">False</span>, <span class="va">True</span>, <span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb20-8"><a></a>ans <span class="op">=</span> {</span>
<span id="cb20-9"><a></a>    <span class="st">'x'</span>   : x,</span>
<span id="cb20-10"><a></a>    <span class="st">'y'</span>   : y,</span>
<span id="cb20-11"><a></a>    <span class="st">'and'</span> : np.logical_and(x, y),</span>
<span id="cb20-12"><a></a>    <span class="st">'or'</span>  : np.logical_or(x, y),</span>
<span id="cb20-13"><a></a>    <span class="st">'xor'</span> : np.logical_xor(x, y)</span>
<span id="cb20-14"><a></a>    }</span>
<span id="cb20-15"><a></a>pa.DataFrame(ans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="or-in-python-bis" class="slide level2">
<h2>* Or in python (bis)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a><span class="kw">def</span> myxor(x,y):</span>
<span id="cb21-2"><a></a>    <span class="cf">return</span> np.logical_or(</span>
<span id="cb21-3"><a></a>        np.logical_and(x, np.logical_not(y)),</span>
<span id="cb21-4"><a></a>        np.logical_and(np.logical_not(x), y)</span>
<span id="cb21-5"><a></a>    )</span>
<span id="cb21-6"><a></a></span>
<span id="cb21-7"><a></a>ans[<span class="st">'myxor'</span>] <span class="op">=</span> myxor(x,y)</span>
<span id="cb21-8"><a></a>pa.DataFrame(ans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will now see applications using the <code>met</code> dataset</p>
</section>
<section id="filtering-subsetting-the-data" class="slide level2 smaller">
<h2>Filtering (subsetting) the data</h2>
<p>Say we need to select records according to some criteria. For example:</p>
<ul>
<li>First day of the month, and</li>
<li>Above latitude 40, and</li>
<li>Elevation outside the range 500 and 1,000.</li>
</ul>
<p>The logical expressions would be</p>
<ul>
<li><code>(day == 1)</code></li>
<li><code>(lat &gt; 40)</code></li>
<li><code>((elev &lt; 500) | (elev &gt; 1000))</code></li>
</ul>
<p>Respectively.</p>
</section>
<section id="data.table" class="slide level2">
<h2>* data.table</h2>
<p>In R with <code>data.table</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a>dat[(day <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">&amp;</span> (lat <span class="sc">&gt;</span> <span class="dv">40</span>) <span class="sc">&amp;</span> ((elev <span class="sc">&lt;</span> <span class="dv">500</span>) <span class="sc">|</span> (elev <span class="sc">&gt;</span> <span class="dv">1000</span>))] <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section class="slide level2">

<p>In base R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>tmp <span class="ot">&lt;-</span> dat[dat<span class="sc">$</span>day <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span></span>
<span id="cb23-2"><a></a>             dat<span class="sc">$</span>lat <span class="sc">&gt;</span> <span class="dv">40</span> <span class="sc">&amp;</span></span>
<span id="cb23-3"><a></a>             (dat<span class="sc">$</span>elev <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">|</span> dat<span class="sc">$</span>elev <span class="sc">&gt;</span> <span class="dv">1000</span>), ]</span>
<span id="cb23-4"><a></a><span class="fu">head</span>(tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     USAFID  WBAN year month day hour min    lat     lon elev wind.sp temp
3009 720113 54829 2019     8   1    0  15 42.543 -83.178  222     1.5 25.0
3010 720113 54829 2019     8   1    0  39 42.543 -83.178  222     2.6 24.4
3011 720113 54829 2019     8   1    0  57 42.543 -83.178  222     4.1 24.0
3012 720113 54829 2019     8   1    1  15 42.543 -83.178  222     4.1 23.5
3013 720113 54829 2019     8   1    1  16 42.543 -83.178  222     3.6 23.5
3014 720113 54829 2019     8   1    1  35 42.543 -83.178  222     3.1 23.0
     atm.press
3009        NA
3010        NA
3011        NA
3012        NA
3013        NA
3014        NA</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a><span class="fu">nrow</span>(tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27623</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>In R with <strong>dplyr::filter()</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a></a>  <span class="fu">filter</span>(day <span class="sc">==</span> <span class="dv">1</span>, lat <span class="sc">&gt;</span> <span class="dv">40</span>, (elev <span class="sc">&lt;</span> <span class="dv">500</span>) <span class="sc">|</span> (elev <span class="sc">&gt;</span> <span class="dv">1000</span>)) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a></a>  <span class="fu">head</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  USAFID  WBAN year month day hour min    lat     lon elev wind.sp temp
1 720113 54829 2019     8   1    0  15 42.543 -83.178  222     1.5 25.0
2 720113 54829 2019     8   1    0  39 42.543 -83.178  222     2.6 24.4
3 720113 54829 2019     8   1    0  57 42.543 -83.178  222     4.1 24.0
4 720113 54829 2019     8   1    1  15 42.543 -83.178  222     4.1 23.5
5 720113 54829 2019     8   1    1  16 42.543 -83.178  222     3.6 23.5
6 720113 54829 2019     8   1    1  35 42.543 -83.178  222     3.1 23.0
  atm.press
1        NA
2        NA
3        NA
4        NA
5        NA
6        NA</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>In Python</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a></a><span class="im">import</span> datatable <span class="im">as</span> dt</span>
<span id="cb29-2"><a></a>dat <span class="op">=</span> dt.fread(<span class="st">"met.gz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a></a>dat[(dt.f.day <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (dt.f.lat <span class="op">&gt;</span> <span class="dv">40</span>) <span class="op">&amp;</span> ((dt.f.elev <span class="op">&lt;</span> <span class="dv">500</span>) <span class="op">|</span> (dt.f.elev <span class="op">&gt;</span> <span class="dv">1000</span>)), :].nrows</span>
<span id="cb30-2"><a></a><span class="co"># dat[dt.f.day == 1,:][dt.f.lat &gt; 40,:][(dt.f.elev &lt; 500) | (dt.f.elev &gt; 1000),:].nrows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the case of pydatatable we use <code>dt.f.</code> to refer to a column. <code>df.</code> is what we use to refer to datatable’s <a href="https://en.wikipedia.org/wiki/Namespace">namespace</a>.</p>
<p>The <code>f.</code> is a <a href="https://datatable.readthedocs.io/en/latest/manual/f-expressions.html">symbol</a> that allows accessing column names in a datatable’s <code>Frame</code>.</p>
</section>
<section id="questions-2" class="slide level2">
<h2>Questions 2</h2>
<ol type="1">
<li><p>How many records have a temperature within 18 and 25?</p></li>
<li><p>Some records have missing values. Count how many records have <code>temp</code> as <code>NA</code>.</p></li>
<li><p>Following the previous question, plot a sample of 1,000 pairs of <code>(lat, lon)</code> coordinates for (a) the stations with <code>temp</code> as <code>NA</code> and (b) those with data.</p></li>
</ol>
</section>
<section id="solutions" class="slide level2">
<h2>Solutions</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a><span class="co"># Question 1</span></span>
<span id="cb31-2"><a></a><span class="fu">nrow</span>(dat[dat<span class="sc">$</span>temp <span class="sc">&lt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> dat<span class="sc">$</span>temp <span class="sc">&gt;</span> <span class="dv">18</span>, ])</span>
<span id="cb31-3"><a></a><span class="co"># dat[temp %between% c(18, 25), .N] </span></span>
<span id="cb31-4"><a></a><span class="co"># dat |&gt; filter(between(temp, 18, 25)) |&gt; nrow()</span></span>
<span id="cb31-5"><a></a></span>
<span id="cb31-6"><a></a><span class="co"># Question 2</span></span>
<span id="cb31-7"><a></a><span class="fu">nrow</span>(dat[<span class="fu">is.na</span>(dat<span class="sc">$</span>temp), ])</span>
<span id="cb31-8"><a></a><span class="co"># more succinct: sum(is.na(dat$temp))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 968136
[1] 60089</code></pre>
</div>
</div>
</section>
<section id="solutions-cont." class="slide level2 smaller">
<h2>Solutions (cont.)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a></a><span class="co"># Question 3</span></span>
<span id="cb33-2"><a></a><span class="co"># Drawing a sample</span></span>
<span id="cb33-3"><a></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb33-4"><a></a>idx1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">which</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>temp)), <span class="dv">1000</span>)</span>
<span id="cb33-5"><a></a>idx2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(dat<span class="sc">$</span>temp)), <span class="dv">1000</span>)</span>
<span id="cb33-6"><a></a></span>
<span id="cb33-7"><a></a><span class="co"># Visualizing the data</span></span>
<span id="cb33-8"><a></a><span class="co"># make a map of the US, as we did last class</span></span>
<span id="cb33-9"><a></a><span class="fu">ggplot</span>(<span class="fu">map_data</span>(<span class="st">"state"</span>), <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb33-10"><a></a>  <span class="fu">geom_map</span>(<span class="fu">aes</span>(<span class="at">map_id =</span> region), <span class="at">map =</span> <span class="fu">map_data</span>(<span class="st">"state"</span>), <span class="at">col =</span> <span class="st">"lightgrey"</span>, <span class="at">fill =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb33-11"><a></a>  <span class="fu">geom_jitter</span>(</span>
<span id="cb33-12"><a></a>    <span class="at">data    =</span> dat[<span class="fu">c</span>(idx1, idx2), ],</span>
<span id="cb33-13"><a></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">col =</span> <span class="fu">is.na</span>(temp)),</span>
<span id="cb33-14"><a></a>    <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">cex =</span> <span class="dv">2</span></span>
<span id="cb33-15"><a></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="week05_files/figure-revealjs/unnamed-chunk-3-1.png" width="672" class="r-stretch"></section>
<section id="creating-variables-data-types" class="slide level2 smaller">
<h2>Creating variables: Data types</h2>
<ul>
<li><p><strong>logical</strong>: Bool true/false type, e.g.&nbsp;dead/alive, sick/healthy, good/bad, yes/no, etc.</p></li>
<li><p><strong>strings</strong>: string of characters (letters/symbols), e.g.&nbsp;names, text, etc.</p></li>
<li><p><strong>integer</strong>: Numeric variable with no decimal (discrete), e.g.&nbsp;age, days, counts, etc.</p></li>
<li><p><strong>double</strong>: Numeric variable with decimals (continuous), e.g.&nbsp;distance, expression level, time.</p></li>
</ul>
<p>In C (and other languages), strings, integers, and doubles may be specified with size, e.g.&nbsp;in <code>python</code> integers can be of 9, 16, and 32 bits. This is relevant when managing large datasets, where saving space can be fundamental (<a href="https://en.wikipedia.org/wiki/C_data_types#Main_types">more info</a>).</p>
</section>
<section id="creating-variables-special-data-types" class="slide level2 smaller">
<h2>Creating variables: Special data types</h2>
<p>Most programming languages have special types which are built using basic types. A few examples:</p>
<ul>
<li><p><strong>time</strong>: Could be date, date + time, or a combination of both. Usually it has a reference number defined as date 0. In R, the <code>Date</code> class has as reference 1970-01-01, in other words, “days since January 1st, 1970”.</p></li>
<li><p><strong>categorical</strong>: Commonly used to represent strata/levels of variables, e.g.&nbsp;a variable “country” could be represented as a factor, where the data is stored as numbers but has a label.</p></li>
<li><p><strong>ordinal</strong>: Similar to factor, but it has ordering, e.g. “satisfaction level: 5 very satisfied, …, 1 very unsatisfied”.</p></li>
</ul>
<p>Other special data types could be ways to represent missings (usually described as <code>na</code> or <code>NA</code>), or special numeric types, e.g.&nbsp;<code>+-Inf</code> and Undefined (<code>NaN</code>).</p>
<p>When storing/sharing datasets, it is a good practice to do it along a dictionary describing each column data type/format.</p>
</section>
<section id="questions-3-whats-the-best-way-to-represent-the-following" class="slide level2 smaller">
<h2>Questions 3: What’s the best way to represent the following</h2>
<ul>
<li><p>0, 1, 1, 0, 0, 1</p></li>
<li><p>Diabetes type 1, Diabetes type 2, Diabetes type 1, Diabetes type 2</p></li>
<li><p>on, off, off, on, on, on</p></li>
<li><p>5, 10, 1, 15, 0, 0, 1</p></li>
<li><p>1.0, 2.0, 10.0, 6.0</p></li>
<li><p>high, low, medium, medium, high</p></li>
<li><p>-1, 1, -1, -1, 1,</p></li>
<li><p>.2, 1.5, .8, <span class="math inline">\(\pi\)</span></p></li>
<li><p><span class="math inline">\(\pi\)</span>, <span class="math inline">\(\exp{1}\)</span>, <span class="math inline">\(\pi\)</span>, <span class="math inline">\(\pi\)</span></p></li>
</ul>
</section>
<section id="variable-creation" class="slide level2">
<h2>Variable creation</h2>
<p>If we wanted to create two variables, <code>elev^2</code> and the scaled version of <code>wind.sp</code> by it’s standard error, we could do the following</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a></a>dat<span class="sc">$</span>elev2 <span class="ot">&lt;-</span> dat<span class="sc">$</span>elev<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb34-2"><a></a>dat<span class="sc">$</span>windsp_scaled <span class="ot">&lt;-</span> dat<span class="sc">$</span>wind.sp <span class="sc">/</span> <span class="fu">sd</span>(dat<span class="sc">$</span>wind.sp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="variable-creation-cont.-1" class="slide level2">
<h2>Variable creation (cont. 1)</h2>
<p>With the verb <strong>dplyr::mutate()</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-3"><a></a>    <span class="at">elev2         =</span> elev <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb35-4"><a></a>    <span class="at">windsp_scaled =</span> wind.sp <span class="sc">/</span> <span class="fu">sd</span>(wind.sp,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb35-5"><a></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-6"><a></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  USAFID  WBAN year month day hour min  lat      lon elev wind.sp temp
1 690150 93121 2019     8   1    0  56 34.3 -116.166  696     5.7 37.2
2 690150 93121 2019     8   1    1  56 34.3 -116.166  696     8.2 35.6
3 690150 93121 2019     8   1    2  56 34.3 -116.166  696     6.7 34.4
4 690150 93121 2019     8   1    3  56 34.3 -116.166  696     5.1 33.3
5 690150 93121 2019     8   1    4  56 34.3 -116.166  696     2.1 32.8
6 690150 93121 2019     8   1    5  56 34.3 -116.166  696     0.0 31.1
  atm.press  elev2 windsp_scaled
1    1009.9 484416      2.654379
2    1010.3 484416      3.818580
3    1010.6 484416      3.120059
4    1011.6 484416      2.374970
5    1012.7 484416      0.977929
6    1012.7 484416      0.000000</code></pre>
</div>
</div>
</section>
<section id="variable-creation-cont.-2" class="slide level2">
<h2>Variable creation (cont. 2)</h2>
<p>Imagine that we needed to scale multiple variables by their SD and didn’t want to copy-paste this code several times. Here’s how we could do it automatically for a given list of variable names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a><span class="co"># Listing the names</span></span>
<span id="cb37-2"><a></a>names  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"wind.sp"</span>, <span class="st">"temp"</span>, <span class="st">"atm.press"</span>)</span>
<span id="cb37-3"><a></a></span>
<span id="cb37-4"><a></a><span class="cf">for</span>(var <span class="cf">in</span> names){</span>
<span id="cb37-5"><a></a>  dat[,<span class="fu">paste0</span>(var,<span class="st">'_scaled'</span>)] <span class="ot">&lt;-</span> dat[,var] <span class="sc">/</span> <span class="fu">sd</span>(dat[,var], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-6"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Why can’t we use <code>dat$var</code> inside the loop?</p>
</section>
<section id="or-with-data.table" class="slide level2">
<h2>* Or with data.table</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a>in_names  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"wind.sp"</span>, <span class="st">"temp"</span>, <span class="st">"atm.press"</span>)</span>
<span id="cb38-2"><a></a>out_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(in_names, <span class="st">"_scaled"</span>)</span>
<span id="cb38-3"><a></a>dat[,</span>
<span id="cb38-4"><a></a>    <span class="fu">c</span>(out_names) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) x<span class="sc">/</span><span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), </span>
<span id="cb38-5"><a></a>    .SDcols <span class="ot">=</span> in_names</span>
<span id="cb38-6"><a></a>    ]</span>
<span id="cb38-7"><a></a></span>
<span id="cb38-8"><a></a><span class="co"># Looking at the first 6</span></span>
<span id="cb38-9"><a></a><span class="fu">head</span>(dat[, .SD, <span class="at">.SDcols =</span> out_names], <span class="at">n =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Key things to notice here: <strong>c(out_names)</strong>, <strong>.SD</strong>, and <strong>.SDCols</strong>.</p>
</section>
<section id="variable-creation-cont.-3" class="slide level2">
<h2>Variable creation (cont. 3)</h2>
<p>In the case of dplyr, we could use the following</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a></a>names  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"wind.sp"</span>, <span class="st">"temp"</span>, <span class="st">"atm.press"</span>)</span>
<span id="cb39-2"><a></a>dat <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-4"><a></a>    <span class="fu">across</span>(</span>
<span id="cb39-5"><a></a>      <span class="fu">all_of</span>(names),</span>
<span id="cb39-6"><a></a>      <span class="cf">function</span>(x) x<span class="sc">/</span><span class="fu">sd</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-7"><a></a>      <span class="at">.names =</span> <span class="st">"{col}_scaled2"</span></span>
<span id="cb39-8"><a></a>      )</span>
<span id="cb39-9"><a></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb39-10"><a></a>  <span class="co"># Just to print the last columns</span></span>
<span id="cb39-11"><a></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"_scaled2"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb39-12"><a></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  wind.sp_scaled2 temp_scaled2 atm.press_scaled2
1        2.654379     6.139348          248.7889
2        3.818580     5.875290          248.8874
3        3.120059     5.677247          248.9613
4        2.374970     5.495707          249.2077</code></pre>
</div>
</div>
</section>
<section id="complex-variable-creation" class="slide level2 smaller">
<h2>Complex variable creation</h2>
<p>Don’t forget about loops! <code>for</code> loops and <code>sapply</code> may be slow on a dataset of this size, but they can be quite handy for creating variables that rely on complicated relationships between variables. Consider this a “brute force” approach. Vectorized methods will <em>always</em> be faster, but these can be easier to conceptualize and, in rare cases, may be the only option.</p>
<p>Consider the problem creating a weird variable: <code>wind.temp</code>. This will take on 4 possible values, based on the temperature and wind speed: cool &amp; still, cool &amp; windy, warm &amp; still, or warm &amp; windy. We will split each variable based on their median value. Note that this code is too slow to actually run on this large dataset.</p>
</section>
<section id="complex-variable-creation-cont-1" class="slide level2 smaller">
<h2>Complex variable creation (cont 1)</h2>
<p>Here’s how we would do that with the <code>sapply</code> function (and a custom, unnamed function):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a></a><span class="co"># create the new variable one entry at a time</span></span>
<span id="cb41-2"><a></a>wind.temp <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dat), <span class="cf">function</span>(i){</span>
<span id="cb41-3"><a></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>temp[i]) <span class="sc">|</span> <span class="fu">is.na</span>(dat<span class="sc">$</span>wind.sp[i])){</span>
<span id="cb41-4"><a></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb41-5"><a></a>  }</span>
<span id="cb41-6"><a></a>  <span class="cf">if</span>(dat<span class="sc">$</span>temp[i] <span class="sc">&lt;=</span> <span class="fu">median</span>(dat<span class="sc">$</span>temp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)){</span>
<span id="cb41-7"><a></a>    <span class="cf">if</span>(dat<span class="sc">$</span>wind.sp[i] <span class="sc">&lt;=</span> <span class="fu">median</span>(dat<span class="sc">$</span>wind.sp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)){</span>
<span id="cb41-8"><a></a>      <span class="fu">return</span>(<span class="st">'cool &amp; still'</span>)</span>
<span id="cb41-9"><a></a>    }<span class="cf">else</span>{</span>
<span id="cb41-10"><a></a>      <span class="fu">return</span>(<span class="st">'cool &amp; windy'</span>)</span>
<span id="cb41-11"><a></a>    }</span>
<span id="cb41-12"><a></a>  }<span class="cf">else</span>{</span>
<span id="cb41-13"><a></a>    <span class="cf">if</span>(dat<span class="sc">$</span>wind.sp[i] <span class="sc">&lt;=</span> <span class="fu">median</span>(dat<span class="sc">$</span>wind.sp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)){</span>
<span id="cb41-14"><a></a>      <span class="fu">return</span>(<span class="st">'warm &amp; still'</span>)</span>
<span id="cb41-15"><a></a>    }<span class="cf">else</span>{</span>
<span id="cb41-16"><a></a>      <span class="fu">return</span>(<span class="st">'warm &amp; windy'</span>)</span>
<span id="cb41-17"><a></a>    }</span>
<span id="cb41-18"><a></a>  }</span>
<span id="cb41-19"><a></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check: what would we need to change to add this variable to our dataset?</p>
</section>
<section id="complex-variable-creation-cont-2" class="slide level2 smaller">
<h2>Complex variable creation (cont 2)</h2>
<p>Here’s the code for doing that with a <code>for</code> loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a></a><span class="co"># initialize a variable of all missing values</span></span>
<span id="cb42-2"><a></a>wind.temp <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(dat))</span>
<span id="cb42-3"><a></a><span class="co"># fill in the values one at a time</span></span>
<span id="cb42-4"><a></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dat)){</span>
<span id="cb42-5"><a></a>  <span class="cf">if</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>temp[i]) <span class="sc">|</span> <span class="fu">is.na</span>(dat<span class="sc">$</span>wind.sp[i])){</span>
<span id="cb42-6"><a></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb42-7"><a></a>  }<span class="cf">else</span>{</span>
<span id="cb42-8"><a></a>    <span class="cf">if</span>(dat<span class="sc">$</span>temp[i] <span class="sc">&lt;=</span> <span class="fu">median</span>(dat<span class="sc">$</span>temp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)){</span>
<span id="cb42-9"><a></a>      <span class="cf">if</span>(dat<span class="sc">$</span>wind.sp[i] <span class="sc">&lt;=</span> <span class="fu">median</span>(dat<span class="sc">$</span>wind.sp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)){</span>
<span id="cb42-10"><a></a>        wind.temp[i] <span class="ot">&lt;-</span> <span class="st">'cool &amp; still'</span></span>
<span id="cb42-11"><a></a>      }<span class="cf">else</span>{</span>
<span id="cb42-12"><a></a>        wind.temp[i] <span class="ot">&lt;-</span> <span class="st">'cool &amp; windy'</span></span>
<span id="cb42-13"><a></a>      }</span>
<span id="cb42-14"><a></a>    }<span class="cf">else</span>{</span>
<span id="cb42-15"><a></a>      <span class="cf">if</span>(dat<span class="sc">$</span>wind.sp[i] <span class="sc">&lt;=</span> <span class="fu">median</span>(dat<span class="sc">$</span>wind.sp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)){</span>
<span id="cb42-16"><a></a>        wind.temp[i] <span class="ot">&lt;-</span> <span class="st">'warm &amp; still'</span></span>
<span id="cb42-17"><a></a>      }<span class="cf">else</span>{</span>
<span id="cb42-18"><a></a>        wind.temp[i] <span class="ot">&lt;-</span> <span class="st">'warm &amp; windy'</span></span>
<span id="cb42-19"><a></a>      }</span>
<span id="cb42-20"><a></a>    }</span>
<span id="cb42-21"><a></a>  }</span>
<span id="cb42-22"><a></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check: why do we need to include <code>na.rm=TRUE</code> when calculating the medians?</p>
</section>
<section id="complex-variable-creation-cont-3" class="slide level2 smaller">
<h2>Complex variable creation (cont 3)</h2>
<p>Here’s a simple vectorized approach that will actually run on a large dataset. This works for our current case, but it’s still a brute force approach, because we had to specifically assign every possible value of our new variable. You can imagine that as the number of possible values increases, this code will get increasingly cumbersome.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a></a><span class="co"># initialize a variable of all missing values</span></span>
<span id="cb43-2"><a></a>wind.temp <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(dat))</span>
<span id="cb43-3"><a></a><span class="co"># assign every possible value by subsetting</span></span>
<span id="cb43-4"><a></a>wind.temp[dat<span class="sc">$</span>temp <span class="sc">&lt;=</span> <span class="fu">median</span>(dat<span class="sc">$</span>temp, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">&amp;</span> </span>
<span id="cb43-5"><a></a>            dat<span class="sc">$</span>wind.sp <span class="sc">&lt;=</span> <span class="fu">median</span>(dat<span class="sc">$</span>wind.sp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)] <span class="ot">&lt;-</span> <span class="st">'cool &amp; still'</span></span>
<span id="cb43-6"><a></a>wind.temp[dat<span class="sc">$</span>temp <span class="sc">&lt;=</span> <span class="fu">median</span>(dat<span class="sc">$</span>temp, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">&amp;</span> </span>
<span id="cb43-7"><a></a>            dat<span class="sc">$</span>wind.sp <span class="sc">&gt;</span> <span class="fu">median</span>(dat<span class="sc">$</span>wind.sp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)] <span class="ot">&lt;-</span> <span class="st">'cool &amp; windy'</span></span>
<span id="cb43-8"><a></a>wind.temp[dat<span class="sc">$</span>temp <span class="sc">&gt;</span> <span class="fu">median</span>(dat<span class="sc">$</span>temp, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">&amp;</span> </span>
<span id="cb43-9"><a></a>            dat<span class="sc">$</span>wind.sp <span class="sc">&lt;=</span> <span class="fu">median</span>(dat<span class="sc">$</span>wind.sp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)] <span class="ot">&lt;-</span> <span class="st">'warm &amp; still'</span></span>
<span id="cb43-10"><a></a>wind.temp[dat<span class="sc">$</span>temp <span class="sc">&gt;</span> <span class="fu">median</span>(dat<span class="sc">$</span>temp, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">&amp;</span> </span>
<span id="cb43-11"><a></a>            dat<span class="sc">$</span>wind.sp <span class="sc">&gt;</span> <span class="fu">median</span>(dat<span class="sc">$</span>wind.sp, <span class="at">na.rm=</span><span class="cn">TRUE</span>)] <span class="ot">&lt;-</span> <span class="st">'warm &amp; windy'</span></span>
<span id="cb43-12"><a></a></span>
<span id="cb43-13"><a></a><span class="fu">head</span>(wind.temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "warm &amp; windy" "warm &amp; windy" "warm &amp; windy" "warm &amp; windy" "warm &amp; still"
[6] "warm &amp; still"</code></pre>
</div>
</div>
</section>
<section id="merging-data" class="slide level2">
<h2>Merging data</h2>
<ul>
<li><p>While building the MET dataset, we dropped the State data.</p></li>
<li><p>We can use the original Stations dataset and <em>merge</em> it to the MET dataset.</p></li>
<li><p>But we cannot do it right away. We need to process the data somewhat first.</p></li>
</ul>
</section>
<section id="merging-data-cont.-1" class="slide level2">
<h2>Merging data (cont. 1)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a></a>stations <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">"https://noaa-isd-pds.s3.amazonaws.com/isd-history.csv"</span>)</span>
<span id="cb45-2"><a></a>stations <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(stations)</span>
<span id="cb45-3"><a></a>stations<span class="sc">$</span>USAF <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(stations<span class="sc">$</span>USAF)</span>
<span id="cb45-4"><a></a></span>
<span id="cb45-5"><a></a><span class="co"># Dealing with NAs and 999999</span></span>
<span id="cb45-6"><a></a>stations<span class="sc">$</span>USAF[stations<span class="sc">$</span>USAF <span class="sc">==</span> <span class="dv">999999</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb45-7"><a></a>stations<span class="sc">$</span>CTRY[stations<span class="sc">$</span>CTRY <span class="sc">==</span> <span class="st">""</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb45-8"><a></a>stations<span class="sc">$</span>STATE[stations<span class="sc">$</span>STATE <span class="sc">==</span> <span class="st">""</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb45-9"><a></a></span>
<span id="cb45-10"><a></a><span class="co"># Selecting the three relevant columns, and keep unique records</span></span>
<span id="cb45-11"><a></a>stations <span class="ot">&lt;-</span> <span class="fu">unique</span>(stations[, <span class="fu">c</span>(<span class="st">'USAF'</span>, <span class="st">'CTRY'</span>, <span class="st">'STATE'</span>)])</span>
<span id="cb45-12"><a></a></span>
<span id="cb45-13"><a></a><span class="co"># Dropping NAs</span></span>
<span id="cb45-14"><a></a>stations <span class="ot">&lt;-</span> stations[<span class="sc">!</span><span class="fu">is.na</span>(stations<span class="sc">$</span>USAF), ]</span>
<span id="cb45-15"><a></a></span>
<span id="cb45-16"><a></a><span class="fu">head</span>(stations, <span class="at">n =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  USAF CTRY STATE
1 7018 &lt;NA&gt;  &lt;NA&gt;
2 7026   AF  &lt;NA&gt;
3 7070   AF  &lt;NA&gt;
4 8260 &lt;NA&gt;  &lt;NA&gt;</code></pre>
</div>
</div>
</section>
<section id="merging-data-cont.-2" class="slide level2 smaller">
<h2>Merging data (cont. 2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a></a><span class="fu">merge</span>(</span>
<span id="cb47-2"><a></a>  <span class="co"># Data</span></span>
<span id="cb47-3"><a></a>  <span class="at">x     =</span> dat,      </span>
<span id="cb47-4"><a></a>  <span class="at">y     =</span> stations, </span>
<span id="cb47-5"><a></a>  <span class="co"># List of variables to match</span></span>
<span id="cb47-6"><a></a>  <span class="at">by.x  =</span> <span class="st">"USAFID"</span>,</span>
<span id="cb47-7"><a></a>  <span class="at">by.y  =</span> <span class="st">"USAF"</span>, </span>
<span id="cb47-8"><a></a>  <span class="co"># Which obs to keep?</span></span>
<span id="cb47-9"><a></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span>,      </span>
<span id="cb47-10"><a></a>  <span class="at">all.y =</span> <span class="cn">FALSE</span></span>
<span id="cb47-11"><a></a>  ) <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2385443</code></pre>
</div>
</div>
<p>This is more rows! The original dataset, <code>dat</code>, has 2377343. This means that the <code>stations</code> dataset has duplicated IDs. We can fix this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a>stations <span class="ot">&lt;-</span> stations[<span class="sc">!</span><span class="fu">duplicated</span>(stations<span class="sc">$</span>USAF), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="merging-data-cont.-3" class="slide level2 smaller">
<h2>Merging data (cont. 3)</h2>
<p>We now can use the function <code>merge()</code> to add the extra data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a></a>dat <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb50-2"><a></a>  <span class="co"># Data</span></span>
<span id="cb50-3"><a></a>  <span class="at">x     =</span> dat,      </span>
<span id="cb50-4"><a></a>  <span class="at">y     =</span> stations, </span>
<span id="cb50-5"><a></a>  <span class="co"># List of variables to match</span></span>
<span id="cb50-6"><a></a>  <span class="at">by.x  =</span> <span class="st">"USAFID"</span>,</span>
<span id="cb50-7"><a></a>  <span class="at">by.y  =</span> <span class="st">"USAF"</span>, </span>
<span id="cb50-8"><a></a>  <span class="co"># Which obs to keep?</span></span>
<span id="cb50-9"><a></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span>,      </span>
<span id="cb50-10"><a></a>  <span class="at">all.y =</span> <span class="cn">FALSE</span></span>
<span id="cb50-11"><a></a>  )</span>
<span id="cb50-12"><a></a></span>
<span id="cb50-13"><a></a><span class="fu">head</span>(dat[, <span class="fu">c</span>(<span class="st">'USAFID'</span>, <span class="st">'WBAN'</span>, <span class="st">'STATE'</span>)], <span class="at">n =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  USAFID  WBAN STATE
1 690150 93121    CA
2 690150 93121    CA
3 690150 93121    CA
4 690150 93121    CA</code></pre>
</div>
</div>
<p>What happens when you change the options <code>all.x</code> and <code>all.y</code>?</p>
</section>
<section id="aggregating-data-adding-grouped-variables" class="slide level2">
<h2>* Aggregating data: Adding grouped variables</h2>
<ul>
<li><p>Many times we need to either impute some data, or generate variables by strata.</p></li>
<li><p>If we, for example, wanted to impute missing temperature with the daily state average, we could use <strong>by</strong> together with the <strong>data.table::fcoalesce()</strong> function:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a></a>dat[, temp_imp <span class="sc">:</span><span class="er">=</span> <span class="fu">fcoalesce</span>(temp, <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb52-2"><a></a>  by <span class="ot">=</span> .(STATE, year, month, day)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aggregating-data-adding-grouped-variables-1" class="slide level2">
<h2>Aggregating data: Adding grouped variables</h2>
<ul>
<li>In the case of dplyr, we can do the following using <strong>dplyr::group_by()</strong> together with <strong>dplyr::coalesce()</strong>:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a>dat <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a></a>  <span class="fu">group_by</span>(STATE, year, month, day) <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb53-4"><a></a>    <span class="at">temp_imp =</span> <span class="fu">coalesce</span>(temp, <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb53-5"><a></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aggregating-data-adding-grouped-variables-cont.-1" class="slide level2">
<h2>Aggregating data: Adding grouped variables (cont. 1)</h2>
<p>Let’s see how it looks:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a></a><span class="co"># Preparing for plotting</span></span>
<span id="cb54-2"><a></a><span class="co"># select single station, sort by date</span></span>
<span id="cb54-3"><a></a>plotdata <span class="ot">&lt;-</span> dat[dat<span class="sc">$</span>USAFID <span class="sc">==</span> <span class="dv">720172</span>, ]</span>
<span id="cb54-4"><a></a>plotdata <span class="ot">&lt;-</span> plotdata[<span class="fu">order</span>(plotdata<span class="sc">$</span>year, plotdata<span class="sc">$</span>month, plotdata<span class="sc">$</span>day, plotdata<span class="sc">$</span>hour, plotdata<span class="sc">$</span>min), ]</span>
<span id="cb54-5"><a></a><span class="co"># Generate an 'x' variable for time</span></span>
<span id="cb54-6"><a></a>plotdata<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(plotdata)</span>
<span id="cb54-7"><a></a></span>
<span id="cb54-8"><a></a></span>
<span id="cb54-9"><a></a><span class="fu">plot</span>(plotdata<span class="sc">$</span>id, plotdata<span class="sc">$</span>temp, <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb54-10"><a></a><span class="fu">lines</span>(plotdata<span class="sc">$</span>id, plotdata<span class="sc">$</span>temp_imp, <span class="at">col=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="week05_files/figure-revealjs/plot-grouped-1.png" width="672" class="r-stretch"></section>
<section id="aggregating-data-adding-grouped-variables-cont.-2" class="slide level2">
<h2>Aggregating data: Adding grouped variables (cont. 2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a></a>plotdata <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> id)) <span class="sc">+</span></span>
<span id="cb55-3"><a></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> temp)) <span class="sc">+</span></span>
<span id="cb55-4"><a></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> temp_imp, <span class="at">colour =</span> <span class="st">'red'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="week05_files/figure-revealjs/plot-grouped-gg-1.png" width="672" class="r-stretch"></section>
<section id="aggregating-data-adding-grouped-variables-cont.-3" class="slide level2">
<h2>Aggregating data: Adding grouped variables (cont. 3)</h2>
<p>Note that when you use <code>group_by()</code>, your data <strong>stays</strong> grouped.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 21
# Groups:   STATE, year, month, day [1]
  USAFID  WBAN  year month   day  hour   min   lat   lon  elev wind.sp  temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 690150 93121  2019     8     1     0    56  34.3 -116.   696     5.7  37.2
2 690150 93121  2019     8     1     1    56  34.3 -116.   696     8.2  35.6
3 690150 93121  2019     8     1     2    56  34.3 -116.   696     6.7  34.4
4 690150 93121  2019     8     1     3    56  34.3 -116.   696     5.1  33.3
5 690150 93121  2019     8     1     4    56  34.3 -116.   696     2.1  32.8
6 690150 93121  2019     8     1     5    56  34.3 -116.   696     0    31.1
# ℹ 9 more variables: atm.press &lt;dbl&gt;, elev2 &lt;dbl&gt;, windsp_scaled &lt;dbl&gt;,
#   wind.sp_scaled &lt;dbl&gt;, temp_scaled &lt;dbl&gt;, atm.press_scaled &lt;dbl&gt;,
#   CTRY &lt;chr&gt;, STATE &lt;chr&gt;, temp_imp &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This can cause headaches downstream if you don’t remember that your data is grouped.</p>
</section>
<section id="aggregating-data-adding-grouped-variables-cont.-4" class="slide level2">
<h2>Aggregating data: Adding grouped variables (cont. 4)</h2>
<p>You can undo the grouping with <code>dplyr::ungroup()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a></a>dat <span class="ot">&lt;-</span> <span class="fu">ungroup</span>(dat)</span>
<span id="cb58-2"><a></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 21
  USAFID  WBAN  year month   day  hour   min   lat   lon  elev wind.sp  temp
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 690150 93121  2019     8     1     0    56  34.3 -116.   696     5.7  37.2
2 690150 93121  2019     8     1     1    56  34.3 -116.   696     8.2  35.6
3 690150 93121  2019     8     1     2    56  34.3 -116.   696     6.7  34.4
4 690150 93121  2019     8     1     3    56  34.3 -116.   696     5.1  33.3
5 690150 93121  2019     8     1     4    56  34.3 -116.   696     2.1  32.8
6 690150 93121  2019     8     1     5    56  34.3 -116.   696     0    31.1
# ℹ 9 more variables: atm.press &lt;dbl&gt;, elev2 &lt;dbl&gt;, windsp_scaled &lt;dbl&gt;,
#   wind.sp_scaled &lt;dbl&gt;, temp_scaled &lt;dbl&gt;, atm.press_scaled &lt;dbl&gt;,
#   CTRY &lt;chr&gt;, STATE &lt;chr&gt;, temp_imp &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="aggregating-data-summary-table" class="slide level2">
<h2>* Aggregating data: Summary table</h2>
<ul>
<li><p>Using <code>by</code> also allow us creating summaries of our data.</p></li>
<li><p>For example, if we wanted to compute the average temperature, wind-speed, and atmospheric pressure by state, we could do the following</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a></a>dat[, .(</span>
<span id="cb60-2"><a></a>  <span class="at">temp_avg      =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb60-3"><a></a>  <span class="at">wind.sp_avg   =</span> <span class="fu">mean</span>(wind.sp, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb60-4"><a></a>  <span class="at">atm.press_avg =</span> <span class="fu">mean</span>(atm.press, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-5"><a></a>  ),</span>
<span id="cb60-6"><a></a>  by <span class="ot">=</span> STATE</span>
<span id="cb60-7"><a></a>  ][<span class="fu">order</span>(STATE)] <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="aggregating-data-summary-table-cont.-1" class="slide level2">
<h2>* Aggregating data: Summary table (cont. 1)</h2>
<p>When dealing with too many variables, we can use the <code>.SD</code> special symbol in <code>data.table</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a></a><span class="co"># Listing the names</span></span>
<span id="cb61-2"><a></a>in_names  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"wind.sp"</span>, <span class="st">"temp"</span>, <span class="st">"atm.press"</span>)</span>
<span id="cb61-3"><a></a>out_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(in_names, <span class="st">"_avg"</span>)</span>
<span id="cb61-4"><a></a></span>
<span id="cb61-5"><a></a>dat[,</span>
<span id="cb61-6"><a></a>  <span class="fu">setNames</span>(<span class="fu">lapply</span>(.SD, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), out_names),</span>
<span id="cb61-7"><a></a>  .SDcols <span class="ot">=</span> in_names, keyby   <span class="ot">=</span> STATE</span>
<span id="cb61-8"><a></a>  ] <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice the <strong>keyby</strong> option here: “Group by STATE and order by STATE”.</p>
</section>
<section id="aggregating-data-summary-table-cont.-2" class="slide level2 smaller">
<h2>Aggregating data: Summary table (cont. 2)</h2>
<ul>
<li>Using <strong>dplyr</strong> verbs</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a></a>dat <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a></a>  <span class="fu">group_by</span>(STATE) <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a></a>  <span class="fu">summarise</span>(</span>
<span id="cb62-4"><a></a>    <span class="at">temp_avg      =</span> <span class="fu">mean</span>(temp, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb62-5"><a></a>    <span class="at">wind.sp_avg   =</span> <span class="fu">mean</span>(wind.sp, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb62-6"><a></a>    <span class="at">atm.press_avg =</span> <span class="fu">mean</span>(atm.press, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-7"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb62-8"><a></a>  <span class="fu">arrange</span>(STATE) <span class="sc">|&gt;</span> </span>
<span id="cb62-9"><a></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  STATE temp_avg wind.sp_avg atm.press_avg
  &lt;chr&gt;    &lt;dbl&gt;       &lt;dbl&gt;         &lt;dbl&gt;
1 AL        26.2        1.57         1016.
2 AR        26.2        1.84         1015.
3 AZ        28.8        2.98         1011.
4 CA        22.4        2.61         1013.</code></pre>
</div>
</div>
<p>Notice the <code>arrange()</code> function.</p>
</section>
<section id="other-data.table-goodies" class="slide level2">
<h2>* Other data.table goodies</h2>
<ul>
<li><p><code>shift()</code> Fast lead/lag for vectors and lists.</p></li>
<li><p><code>fifelse()</code> Fast if-else, similar to base R’s <code>ifelse()</code>.</p></li>
<li><p><code>fcoalesce()</code> Fast coalescing of missing values.</p></li>
<li><p><code>%between%</code> A short form of <code>(x &lt; lb) &amp; (x &gt; up)</code></p></li>
<li><p><code>%inrange%</code> A short form of <code>x %in% lb:up</code></p></li>
<li><p><code>%chin%</code> Fast match of character vectors, equivalent to <code>x %in% X</code>, where both <code>x</code> and <code>X</code> are character vectors.</p></li>
<li><p><code>nafill()</code> Fill missing values using a constant, last observed value, or the next observed value.</p></li>
</ul>
</section>
<section id="benchmarks" class="slide level2">
<h2>Benchmarks</h2>
<ul>
<li><p><a href="https://www.h2o.ai/">H2O.ai</a>’s benchmark (<a href="https://h2oai.github.io/db-benchmark/">link</a>): Designed by the lead developer of data.table <a href="https://rdatatable.gitlab.io/data.table/">Matt Dowle</a></p></li>
<li><p><a href="https://rstudio.com">RStudio’s</a> benchmark (<a href="https://cran.r-project.org/web/packages/vroom/vignettes/benchmarks.html">link</a>): Designed as part of the benchmarks with the <a href="https://cran.r-package.org/package=vroom">vroom</a> package.</p></li>
</ul>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>